@model Dictionary<(DateTime Date, int TimeSlot), List<(int DoctorId, string DoctorName)>>

@{
    Layout = null;
    var startDate = (DateTime)ViewData["StartDate"];
    var daysInMonth = DateTime.DaysInMonth(startDate.Year, startDate.Month);
    var today = DateTime.Today;
    var firstDayOfMonth = new DateTime(startDate.Year, startDate.Month, 1);
    var dayOfWeek = (int)firstDayOfMonth.DayOfWeek;
    var totalCells = daysInMonth + dayOfWeek;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//unpkg.com/layui@2.9.10/dist/css/layui.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: white;
            color: black;
            text-align: center;
            height: 100vh;
            overflow: hidden;
        }

        h2 {
            color: black;
            padding: 20px;
            font-size: 40px;
        }

        .layui-table {
            table-layout: fixed;
            width: 100%;
            max-width: 1200px;
        }

            .layui-table th, .layui-table td {
                width: 100px;
                height: 100px;
                text-align: center;
                vertical-align: middle;
            }

        .layui-btn-fluid {
            width: 100%;
        }

        .buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .today {
            background-color: #FFD700; /* 黄色 */
        }

        .day-cell {
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            position: relative;
        }

        .close {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .schedule-slot {
            margin-top: 10px;
            padding: 5px;
            border: 1px solid #ccc;
        }
    </style>
    <script src="//unpkg.com/layui@2.9.10/dist/layui.js"></script>
</head>
<body>
    <h2>@startDate.Year 年 @startDate.Month 月排班表</h2>
    <table class="layui-table">
        <thead>
            <tr>
                <th>星期日</th>
                <th>星期一</th>
                <th>星期二</th>
                <th>星期三</th>
                <th>星期四</th>
                <th>星期五</th>
                <th>星期六</th>
            </tr>
        </thead>
        <tbody>
            @for (var i = 0; i < 6; i++)
            {
                <tr>
                    @for (var j = 0; j < 7; j++)
                    {
                        var cellIndex = i * 7 + j;
                        if (cellIndex < dayOfWeek || cellIndex >= totalCells)
                        {
                            <td></td>
                        }
                        else
                        {
                            var date = firstDayOfMonth.AddDays(cellIndex - dayOfWeek);
                            var keyMorning = (date, 1);
                            var keyAfternoon = (date, 2);
                            var keyNight = (date, 3);

                            <td class="day-cell @(date.Date == today.Date ? "today" : "")" onclick="showDetails('@date.ToString("yyyy-MM-dd")')">
                                @date.ToString("MM/dd")
                                <br />
                                @date.ToString("ddd")
                                <br />
                                <button class="layui-btn layui-btn-sm layui-btn-fluid">查看詳情</button>
                                <div id="morningDetails_@date.ToString("yyyy_MM_dd")" style="display: none;">
                                    @foreach (var doctor in Model.ContainsKey(keyMorning) ? Model[keyMorning] : new List<(int DoctorId, string DoctorName)>())
                                    {
                                        <div>@doctor.DoctorName</div>
                                    }
                                </div>
                                <div id="afternoonDetails_@date.ToString("yyyy_MM_dd")" style="display: none;">
                                    @foreach (var doctor in Model.ContainsKey(keyAfternoon) ? Model[keyAfternoon] : new List<(int DoctorId, string DoctorName)>())
                                    {
                                        <div>@doctor.DoctorName</div>
                                    }
                                </div>
                                <div id="nightDetails_@date.ToString("yyyy_MM_dd")" style="display: none;">
                                    @foreach (var doctor in Model.ContainsKey(keyNight) ? Model[keyNight] : new List<(int DoctorId, string DoctorName)>())
                                    {
                                        <div>@doctor.DoctorName</div>
                                    }
                                </div>
                            </td>
                        }
                    }
                </tr>
            }
        </tbody>
    </table>
    <div class="buttons">
        <form method="get" action="@Url.Action("Index")">
            <input type="hidden" name="startDate" value="@startDate.AddMonths(-1).ToString("yyyy-MM-dd")" />
            <button type="submit" class="layui-btn">上月</button>
        </form>
        <form method="get" action="@Url.Action("Index")">
            <input type="hidden" name="startDate" value="@startDate.AddMonths(1).ToString("yyyy-MM-dd")" />
            <button type="submit" class="layui-btn">下月</button>
        </form>
        <form method="get" action="@Url.Action("Index", "Home")">
            <input type="hidden" name="startDate" />
            <button type="submit" class="layui-btn">回首頁</button>
        </form>
    </div>

    <!-- 彈出視窗 -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 id="dateHeader"></h3>
            <div id="morningDetails"></div>
            <div id="afternoonDetails"></div>
            <div id="nightDetails"></div>
        </div>
    </div>

    <script>
        function showDetails(date) {
            var modal = document.getElementById('detailsModal');
            var dateHeader = document.getElementById('dateHeader');
            var morningDetails = document.getElementById('morningDetails');
            var afternoonDetails = document.getElementById('afternoonDetails');
            var nightDetails = document.getElementById('nightDetails');

            dateHeader.innerText = date;

            // Clear previous details
            morningDetails.innerHTML = '';
            afternoonDetails.innerHTML = '';
            nightDetails.innerHTML = '';

            // Show corresponding details
            document.getElementById('morningDetails_' + date.replace(/-/g, '_')).style.display = 'block';
            document.getElementById('afternoonDetails_' + date.replace(/-/g, '_')).style.display = 'block';
            document.getElementById('nightDetails_' + date.replace(/-/g, '_')).style.display = 'block';

            modal.style.display = 'block';
        }

        function closeModal() {
            var modal = document.getElementById('detailsModal');
            modal.style.display = 'none';
        }
    </script>

</body>
</html>
