@using _0611_2.Models
@model Dictionary<(DateTime Date, int TimeSlot), List<(int DoctorId, string DoctorName)>>

@{
    ViewData["Title"] = "Schedules";
    var firstDayOfMonth = (DateTime)ViewData["Month"];
    var daysInMonth = DateTime.DaysInMonth(firstDayOfMonth.Year, firstDayOfMonth.Month);
    var today = DateTime.Today; // 获取今天的日期
}

<h2>醫生排班總表</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}
<h3>Doctors</h3>
<ul>
    @foreach (var doctor in (List<Doctor>)ViewData["Doctors"])
    {
        <li>
            <a asp-action="DoctorSchedules" asp-route-doctorId="@doctor.DoctorId">@doctor.DoctorName</a>
        </li>
    }
</ul>

<div class="calendar">
    @for (var day = 1; day <= daysInMonth; day++)
    {
        var currentDate = new DateTime(firstDayOfMonth.Year, firstDayOfMonth.Month, day);
        <div class="day @(currentDate.Date == today.Date ? "today" : "")">
            <h3>
                @currentDate.ToString("yyyy-MM-dd")
                <a class="btn btn-primary btn-sm" asp-action="Create" asp-route-date="@currentDate.ToString("yyyy-MM-dd")">創建排班</a>
            </h3>
            <div class="time-slots">
                @foreach (var slot in Enum.GetValues(typeof(TimeSlot)))
                {
                    var timeSlot = (TimeSlot)slot;
                    var key = (currentDate, (int)timeSlot);
                    <div class="time-slot">
                        <strong>@timeSlot</strong>
                        <ul>
                            @if (Model.ContainsKey(key))
                            {
                                @if (Model[key].Count > 0)
                                {
                                    @foreach (var (DoctorId, DoctorName) in Model[key])
                                    {
                                        <li>@DoctorName</li>
                                    }
                                }
                                else
                                {
                                    <li>No schedules</li>
                                }
                            }
                            else
                            {
                                <li>No schedules</li>
                            }
                        </ul>
                    </div>
                }
            </div>
        </div>
    }
</div>

<div class="buttons">
    <form method="get" action="@Url.Action("Index")">
        <input type="hidden" name="Month" value="@firstDayOfMonth.AddMonths(-1).ToString("yyyy-MM-dd")" />
        <button type="submit" class="layui-btn prev-month">上月</button>
    </form>
    <form method="get" action="@Url.Action("Index")">
        <input type="hidden" name="Month" value="@firstDayOfMonth.AddMonths(1).ToString("yyyy-MM-dd")" />
        <button type="submit" class="layui-btn next-month">下月</button>
    </form>
    <form method="get" action="@Url.Action("Index", "Home")">
        <input type="hidden" name="startDate" />
        <button type="submit" class="layui-btn home">回首頁</button>
    </form>
</div>

@section Scripts {
    <script>
        function showDetails(date) {
            var modal = document.getElementById('detailsModal');
            var dateHeader = document.getElementById('dateHeader');
            var modalMorningDetails = document.getElementById('modalMorningDetails');
            var modalAfternoonDetails = document.getElementById('modalAfternoonDetails');
            var modalNightDetails = document.getElementById('modalNightDetails');

            dateHeader.innerText = date;

            // 清除之前的详细信息
            modalMorningDetails.innerHTML = '';
            modalAfternoonDetails.innerHTML = '';
            modalNightDetails.innerHTML = '';

            // 显示对应的详细信息
            var morningDetails = document.getElementById('morningDetails_' + date.replace(/-/g, '_')).innerHTML;
            var afternoonDetails = document.getElementById('afternoonDetails_' + date.replace(/-/g, '_')).innerHTML;
            var nightDetails = document.getElementById('nightDetails_' + date.replace(/-/g, '_')).innerHTML;

            modalMorningDetails.innerHTML = '<h4>Morning</h4>' + morningDetails;
            modalAfternoonDetails.innerHTML = '<h4>Afternoon</h4>' + afternoonDetails;
            modalNightDetails.innerHTML = '<h4>Night</h4>' + nightDetails;

            // 显示弹出窗口
            modal.style.display = 'block';
        }

        function closeModal() {
            var modal = document.getElementById('detailsModal');
            modal.style.display = 'none';
        }
    </script>
}

<style>
    .calendar {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .day {
        width: 18%;
        box-sizing: border-box;
        border: 1px solid #ddd;
        margin: 1%;
        padding: 10px;
        background-color: #f9f9f9;
        border-radius: 4px;
    }

        .day.today {
            border: 2px solid #007bff; /* 显示当天的边框颜色 */
            background-color: #e9f7ff; /* 显示当天的背景颜色 */
        }

        .day h3 {
            margin: 0;
            font-size: 16px;
            margin-bottom: 10px;
        }

    .time-slots {
        margin-top: 10px;
    }

    .time-slot {
        margin-bottom: 10px;
    }

        .time-slot ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .time-slot li {
            margin: 5px 0;
        }

    .btn-primary {
        background-color: #007bff;
        border: none;
        color: white;
        padding: 5px 10px;
        text-decoration: none;
        border-radius: 4px;
    }

        .btn-primary:hover {
            background-color: #0056b3;
        }

    .buttons {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        gap: 10px;
    }

        .buttons form {
            display: inline;
        }

        .buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .buttons .prev-month {
            background-color: #28a745; /* 绿色 */
        }

        .buttons .next-month {
            background-color: #28a745; /* 绿色 */
        }

        .buttons .home {
            background-color: #28a745; /* 绿色 */
        }
</style>
